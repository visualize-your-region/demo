(self.webpackChunkvyr=self.webpackChunkvyr||[]).push([[977],{1977:(t,e,i)=>{"use strict";i.r(e),i.d(e,{TopnModule:()=>G});var r=i(4446),n=i(4369),o=i(7307),a=i(649),s=i(1041),l=i(9550),p=i(3070),c=i(9961),u=i(3337),m=i(1116),h=i(4660),d=i(3835),g=i(3982),b=i(7701),f=i(3837),x=i(1305),v=i(173),Z=i(1744),w=i(5366),A=i(7723),I=i(9348),T=i(5420),y=i(373),O=i(9572),q=i(4311),S=i(7064);function C(t,e){1&t&&w._UZ(0,"select-project-warning")}function _(t,e){if(1&t&&(w.TgZ(0,"mat-option",25),w._uU(1),w.qZA()),2&t){const t=e.$implicit;w.Q6J("value",t.label),w.xp6(1),w.hij(" ",t.label," ")}}function J(t,e){if(1&t&&(w.TgZ(0,"mat-option",25),w._uU(1),w.qZA()),2&t){const t=e.$implicit;w.Q6J("value",t.label),w.xp6(1),w.hij(" ",t.label," ")}}function N(t,e){1&t&&(w.TgZ(0,"div",26),w.TgZ(1,"div",27),w.TgZ(2,"div",28),w._uU(3),w.ALo(4,"translate"),w.qZA(),w.TgZ(5,"div",29),w._uU(6),w.ALo(7,"translate"),w.qZA(),w.qZA(),w.qZA()),2&t&&(w.xp6(3),w.Oqu(w.lcZ(4,2,"top-n.info.title")),w.xp6(3),w.Oqu(w.lcZ(7,4,"top-n.info.content")))}function M(t,e){if(1&t){const t=w.EpF();w.TgZ(0,"button",30),w.NdJ("click",function(){return w.CHM(t),w.oxw(2).applyFilters()}),w._uU(1),w.ALo(2,"translate"),w.qZA()}2&t&&(w.xp6(1),w.hij(" ",w.lcZ(2,1,"common.back")," "))}function U(t,e){1&t&&w._UZ(0,"div",31)}function k(t,e){1&t&&w._UZ(0,"div",32)}function Q(t,e){1&t&&w._UZ(0,"div",33)}function j(t,e){1&t&&w._UZ(0,"div",34)}function L(t,e){1&t&&w._UZ(0,"div",35)}function E(t,e){1&t&&w._UZ(0,"div",36)}function F(t,e){if(1&t){const t=w.EpF();w.TgZ(0,"div",2),w.TgZ(1,"div",3),w._uU(2),w.ALo(3,"translate"),w.qZA(),w.TgZ(4,"div",4),w.TgZ(5,"mat-form-field",5),w.TgZ(6,"mat-label"),w._uU(7),w.ALo(8,"translate"),w.qZA(),w._UZ(9,"input",6),w._UZ(10,"help-icon",7),w.ALo(11,"translate"),w.qZA(),w.TgZ(12,"mat-form-field",5),w.TgZ(13,"mat-label"),w._uU(14),w.ALo(15,"translate"),w.qZA(),w._UZ(16,"input",8),w._UZ(17,"help-icon",7),w.ALo(18,"translate"),w.TgZ(19,"mat-autocomplete",null,9),w.YNc(21,_,2,2,"mat-option",10),w.qZA(),w.qZA(),w.TgZ(22,"mat-form-field",5),w.TgZ(23,"mat-label"),w._uU(24),w.ALo(25,"translate"),w.qZA(),w._UZ(26,"input",11),w._UZ(27,"help-icon",7),w.ALo(28,"translate"),w.TgZ(29,"mat-autocomplete",null,12),w.YNc(31,J,2,2,"mat-option",10),w.qZA(),w.qZA(),w.TgZ(32,"mat-slide-toggle",13),w.ALo(33,"translate"),w._uU(34),w.ALo(35,"translate"),w.qZA(),w.TgZ(36,"mat-slide-toggle",14),w.ALo(37,"translate"),w._uU(38),w.ALo(39,"translate"),w.qZA(),w.TgZ(40,"button",15),w.NdJ("click",function(){return w.CHM(t),w.oxw().applyFilters()}),w._uU(41),w.ALo(42,"translate"),w.qZA(),w.qZA(),w.TgZ(43,"div",16),w.YNc(44,N,8,6,"div",17),w.YNc(45,M,3,3,"button",18),w.YNc(46,U,1,0,"div",19),w.YNc(47,k,1,0,"div",20),w.YNc(48,Q,1,0,"div",21),w.YNc(49,j,1,0,"div",22),w.YNc(50,L,1,0,"div",23),w.YNc(51,E,1,0,"div",24),w.qZA(),w.qZA()}if(2&t){const t=w.MAs(20),e=w.MAs(30),i=w.oxw();w.xp6(2),w.Oqu(w.lcZ(3,26,"top-n.subtitle")),w.xp6(2),w.Q6J("formGroup",i.formGroup),w.xp6(3),w.Oqu(w.lcZ(8,28,"top-n.header.num-elements")),w.xp6(3),w.Q6J("text",w.lcZ(11,30,"top-n.header.help-num-elements")),w.xp6(4),w.Oqu(w.lcZ(15,32,"top-n.header.attribute")),w.xp6(2),w.Q6J("matAutocomplete",t),w.xp6(1),w.Q6J("text",w.lcZ(18,34,"top-n.header.help-attribute")),w.xp6(4),w.Q6J("ngForOf",i.attributes),w.xp6(3),w.Oqu(w.lcZ(25,36,"top-n.header.period")),w.xp6(2),w.Q6J("matAutocomplete",e),w.xp6(1),w.Q6J("text",w.lcZ(28,38,"top-n.header.help-period")),w.xp6(4),w.Q6J("ngForOf",i.periods),w.xp6(1),w.Q6J("matTooltip",w.lcZ(33,40,"top-n.header.toggle-help")),w.xp6(2),w.hij(" ",w.lcZ(35,42,"top-n.header.toggle")," "),w.xp6(2),w.Q6J("matTooltip",w.lcZ(37,44,"top-n.header.toggle-zero-help")),w.xp6(2),w.hij(" ",w.lcZ(39,46,"top-n.header.toggle-zero")," "),w.xp6(2),w.Q6J("disabled",i.formGroup.invalid),w.xp6(1),w.hij(" ",w.lcZ(42,48,"top-n.header.submit")," "),w.xp6(3),w.Q6J("ngIf",!i.loaded),w.xp6(1),w.Q6J("ngIf",i.hide.meso||i.hide.micro||i.hide.municipy),w.xp6(1),w.Q6J("ngIf",!i.hide.meso),w.xp6(1),w.Q6J("ngIf",!i.hide.meso),w.xp6(1),w.Q6J("ngIf",!i.hide.meso),w.xp6(1),w.Q6J("ngIf",!i.hide.micro),w.xp6(1),w.Q6J("ngIf",!i.hide.micro),w.xp6(1),w.Q6J("ngIf",!i.hide.municipy)}}let Y=(()=>{class t{constructor(t,e,i,r){this.engineService=t,this.pubsub=e,this.cdr=i,this.translateService=r,this.loaded=!1,this.attributes=[],this.periods=[],this.formGroup=new s.cw({numberOfElements:new s.NI(5,[s.kI.required]),attribute:new s.NI(null,[s.kI.required]),period:new s.NI(null,[s.kI.required]),decrescent:new s.NI(!0),ignoreZero:new s.NI(!1)}),this.hide={meso:!1,micro:!1,municipy:!1},this.subscriptions=[],this.translations={}}ngOnInit(){this.subscriptions.push((0,x.aj)([this.translateService.get("top-n.microregions-in-mesoregion"),this.translateService.get("top-n.municipalities-in-microregion"),this.translateService.get("model-constants.municipy"),this.translateService.get("model-constants.municipalities"),this.translateService.get("model-constants.microregion"),this.translateService.get("model-constants.microregions"),this.translateService.get("model-constants.mesoregion"),this.translateService.get("model-constants.mesoregions")]).subscribe(t=>{this.translations.microInMeso=t[0],this.translations.munInMicro=t[1],this.translations.municipy=t[2],this.translations.municipalities=t[3],this.translations.microregion=t[4],this.translations.microregions=t[5],this.translations.mesoregion=t[6],this.translations.mesoregions=t[7]})),this.subscriptions.push(this.pubsub.getAsBehaviorSubject(f.Y.GLOBAL_STATE_CHANGE).pipe((0,d.h)(Boolean),(0,g.zg)(t=>this.engineService.getEngineEvolution(t))).subscribe(t=>{this.initiated=!0,this.attributes=t.dataFor.map(h.C.build),this.periods=t.periods.map(h.C.build),this.baseFilters={attributes:t.dataFor,periods:t.periods},this.evolutionData={municipalities:Object.values(t.municipalities),microregion:Object.values(t.microregion),mesoregion:Object.values(t.mesoregion)}})),this.subscriptions.push(this.formGroup.controls.attribute.valueChanges.pipe((0,b.b)(300)).subscribe(t=>{this.attributes=this.baseFilters.attributes.filter(e=>v.x.contains(e,t)).map(h.C.build),this.cdr.detectChanges()}),this.formGroup.controls.period.valueChanges.pipe((0,b.b)(300)).subscribe(t=>{this.periods=this.baseFilters.periods.filter(e=>v.x.contains(e,t)).map(h.C.build),this.cdr.detectChanges()}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}applyFilters(){const t=this.formGroup.value,e=this.baseFilters.attributes.indexOf(t.attribute),i=this.baseFilters.periods.indexOf(t.period);this.dataset=["mesoregion","microregion","municipalities"].map(r=>{const n=this.evolutionData[r].filter(r=>!t.ignoreZero||r.numericEvolution[e].value[i]>0).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return t.decrescent&&n.reverse(),n}),this.loaded=!0,this.buildCharts(i,e)}buildCharts(t,e){Object.keys(this.hide).forEach(t=>this.hide[t]=!1),document.querySelectorAll(".chart-outlet").forEach(t=>t.innerHTML=""),setTimeout(()=>{const i=this.baseFilters.periods[t],r=this.baseFilters.attributes[e],n=this.formGroup.value.numberOfElements;let[o,a,s]=this.dataset;o=o.slice(0,n),a=a.slice(0,n),s=s.slice(0,n),[o,a,s].forEach((o,a)=>{const s=document.querySelector(`#chart-${a+1}`);let l="mesoregion",p="a";1===a?(l="microregion",p="b"):2===a&&(l="municipalities",p="c");const c=[{typeOfSet:l,group:p,period:i,attribute:r,periodIndex:t,attributeIndex:e,x:o.map(({name:t})=>t),y:o.map(({attribute:t})=>t),type:"bar"}],u={title:this.buildChartTitle(n,r,a,1===n,i,this.dataset[a].length)};Z.newPlot(s,c,u,{responsive:!0}),s.on("plotly_click",t=>{const[e]=t.points;this.handleMainChartClick({period:i,attribute:r,label:e.label,attributeIndex:e.data.attributeIndex,periodIndex:e.data.periodIndex,typeOfSet:e.data.typeOfSet})})})},100)}buildChartTitle(t,e,i,r,n,o){let a=`Top ${t=t>o?o:t} de ${o} - ${n} - ${e} <br>`;return a+=0===i?r?this.translations.mesoregions:this.translations.mesoregion:1===i?r?this.translations.microregions:this.translations.microregion:r?this.translations.municipalities:this.translations.municipy,a}handleMainChartClick(t){const e=this.formGroup.value.numberOfElements,i=this.formGroup.controls.decrescent.value,{periodIndex:r,attributeIndex:n,label:o,period:a,attribute:s}=t;if("mesoregion"===t.typeOfSet){const l=document.querySelector("#chart-1-a-1");this.hide.micro=!0,this.hide.municipy=!0;const p=this.getMicroregionsOfDataMesoregion(t,n,r,i),c=p.slice(0,e);setTimeout(()=>l.scrollIntoView(),300),this.buildSet(c.map(({name:t})=>t),c.map(({attribute:t})=>t),"green",this.buildSubChartTitle(e,p.length,a,s,this.translations.microInMeso,o),l,t=>{const o=document.querySelector("#chart-1-a-2"),[l]=t.points,p=this.getMunicipalitiesOfDataMicroregion(l,n,r,i),c=p.slice(0,e);setTimeout(()=>o.scrollIntoView(),300),this.buildSet(c.map(({name:t})=>t),c.map(({attribute:t})=>t),"orange",this.buildSubChartTitle(e,p.length,a,s,this.translations.munInMicro,l.label),o)})}else if("microregion"===t.typeOfSet){this.hide.meso=!0,this.hide.municipy=!0;const o=this.getMunicipalitiesOfDataMicroregion(t,n,r,i),l=o.slice(0,e);this.buildSet(l.map(({name:t})=>t),l.map(({attribute:t})=>t),"orange",this.buildSubChartTitle(e,o.length,a,s,this.translations.munInMicro,t.label),document.querySelector("#chart-2-a-1"))}}buildSubChartTitle(t,e,i,r,n,o){return`Top ${t>e?e:t} de ${e} - ${i} - ${r} ${n?"<br>"+n+"<br>":""} ${o}`}buildSet(t,e,i,r,n,o=null){n.innerHTML="",Z.newPlot(n,[{x:t,y:e,type:"bar",marker:{color:i}}],{title:r},{responsive:!0}),o&&n.on("plotly_click",o)}getMicroregionsOfDataMesoregion(t,e,i,r){const n=Object.values(this.evolutionData.mesoregion).find(({name:e})=>e===t.label),o=Object.values(this.evolutionData.microregion).filter(({mesoregion_id:t})=>t===n.id).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return r&&o.reverse(),o}getMunicipalitiesOfDataMicroregion(t,e,i,r){const n=Object.values(this.evolutionData.microregion).find(({name:e})=>e===t.label),o=Object.values(this.evolutionData.municipalities).filter(({microregion_id:t})=>t===n.id).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return r&&o.reverse(),o}}return t.\u0275fac=function(e){return new(e||t)(w.Y36(A.S),w.Y36(I.A),w.Y36(w.sBO),w.Y36(a.sK))},t.\u0275cmp=w.Xpm({type:t,selectors:[["app-topn"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","top-n-wrapper",4,"ngIf"],[1,"top-n-wrapper"],[1,"toolbar"],[1,"header",3,"formGroup"],["appearance","outline",1,"filter-element"],["matInput","","formControlName","numberOfElements"],["matSuffix","",3,"text"],["matInput","","formControlName","attribute",3,"matAutocomplete"],["attrsRef","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","period",3,"matAutocomplete"],["periodRef","matAutocomplete"],["formControlName","decrescent",3,"matTooltip"],["formControlName","ignoreZero",2,"min-width","120px","margin-left","8px",3,"matTooltip"],["mat-raised-button","","color","accent",3,"disabled","click"],[1,"content"],["class","parametric-search-content","style","padding: 16px;",4,"ngIf"],["mat-raised-button","","color","accent","class","reset-button",3,"click",4,"ngIf"],["id","chart-1","class","chart-outlet",4,"ngIf"],["id","chart-1-a-1","class","chart-outlet",4,"ngIf"],["id","chart-1-a-2","class","chart-outlet",4,"ngIf"],["id","chart-2","class","chart-outlet",4,"ngIf"],["id","chart-2-a-1","class","chart-outlet",4,"ngIf"],["id","chart-3","class","chart-outlet",4,"ngIf"],[3,"value"],[1,"parametric-search-content",2,"padding","16px"],[1,"box","box-info"],[1,"box-title"],[1,"box-content"],["mat-raised-button","","color","accent",1,"reset-button",3,"click"],["id","chart-1",1,"chart-outlet"],["id","chart-1-a-1",1,"chart-outlet"],["id","chart-1-a-2",1,"chart-outlet"],["id","chart-2",1,"chart-outlet"],["id","chart-2-a-1",1,"chart-outlet"],["id","chart-3",1,"chart-outlet"]],template:function(t,e){1&t&&(w.YNc(0,C,1,0,"select-project-warning",0),w.YNc(1,F,52,50,"div",1)),2&t&&(w.Q6J("ngIf",!e.initiated),w.xp6(1),w.Q6J("ngIf",e.initiated))},directives:[m.O5,T.D,s.JL,s.sg,p.KE,p.hX,l.Nt,s.Fj,s.JJ,s.u,y.w,p.R9,c.ZL,c.XC,m.sg,O.Rr,q.gM,n.lW,S.ey],pipes:[a.X$],styles:["[_ngcontent-%COMP%]:root{--pallete-primary:#000;--pallete-accent:#000;--sidenav-width:200px}  .top-n-wrapper .header{display:flex}  .top-n-wrapper .header{align-items:center;justify-content:space-around}  .top-n-wrapper .header{padding:16px}  .top-n-wrapper .header .filter-element{width:100%;margin-right:16px}  .top-n-wrapper .header .filter-element .mat-form-field-wrapper{padding-bottom:0;margin:0}  .top-n-wrapper .header .mat-slide-toggle{height:55px;min-width:250px}  .top-n-wrapper .header button{min-width:100px;margin-left:16px}  .top-n-wrapper .filter-element .mat-form-field-outline{background:#fff}  .top-n-wrapper .content{max-height:calc(var(--innerHeight) - 128px);height:calc(var(--innerHeight) - 215px);overflow-y:auto;overflow-x:hidden;background:#fff}  .top-n-wrapper .reset-button{margin-top:16px;margin-left:16px}  .top-n-wrapper .chart-element{width:95%;max-width:95%}@media screen and (min-width:1200px) and (max-width:1300px){  .top-n-wrapper .mat-form-field{width:calc(33.3% - 11px)!important}  .top-n-wrapper .content{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}  .top-n-wrapper text.gtitle{font-size:14px!important}  .top-n-wrapper .header{flex-wrap:wrap;align-items:baseline}  .top-n-wrapper .header .filter-element{margin:0 0 16px}  .top-n-wrapper .header .mat-slide-toggle{margin:0 0 16px auto}}  .is-mobile .top-n-wrapper .content{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}  .is-mobile .top-n-wrapper text.gtitle{font-size:14px!important}  .is-mobile .top-n-wrapper .header{flex-wrap:wrap}  .is-mobile .top-n-wrapper .header .filter-element{margin:0 0 16px}  .is-mobile .top-n-wrapper .header .mat-slide-toggle{margin:0 0 16px auto}  .is-mobile .top-n-wrapper .header button{width:100%;margin:0}  .is-phone .top-n-wrapper .header .mat-slide-toggle{margin-right:auto}"]}),t})(),$=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[m.ez,u.Bz.forChild([{path:"",component:Y}])],u.Bz]}),t})();var D=i(408);let G=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[m.ez,$,c.Bb,p.lN,l.c,a.aw,s.u5,O.rP,s.UX,o.Ps,r.q,n.ot,q.AV,D.q]]}),t})()}}]);