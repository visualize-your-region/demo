(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"M8+y":function(t,e,i){"use strict";i.r(e),i.d(e,"TopnModule",function(){return $});var r=i("mVQt"),o=i("bTqV"),a=i("NFeN"),n=i("sYmb"),c=i("3Pt+"),s=i("qFsG"),l=i("kmnG"),u=i("/1cH"),p=i("tyNb"),b=i("ofXK"),d=i("YX9y"),m=i("pLZG"),h=i("5+tZ"),f=i("Kj3r"),g=i("f48q"),v=i("Iw1v"),w=i("95T3"),y=i("fXoL"),M=i("49/o"),I=i("sVDV"),O=i("FkH8"),A=i("1jcm"),x=i("FKr1");function F(t,e){1&t&&y.Mb(0,"select-project-warning")}function S(t,e){if(1&t&&(y.Rb(0,"mat-option",22),y.Dc(1),y.Qb()),2&t){const t=e.$implicit;y.ic("value",t.label),y.Ab(1),y.Fc(" ",t.label," ")}}function C(t,e){if(1&t&&(y.Rb(0,"mat-option",22),y.Dc(1),y.Qb()),2&t){const t=e.$implicit;y.ic("value",t.label),y.Ab(1),y.Fc(" ",t.label," ")}}function D(t,e){if(1&t){const t=y.Sb();y.Rb(0,"button",23),y.Yb("click",function(){return y.sc(t),y.cc(2).applyFilters()}),y.Dc(1),y.dc(2,"translate"),y.Qb()}2&t&&(y.Ab(1),y.Fc(" ",y.ec(2,1,"common.back")," "))}function j(t,e){1&t&&y.Mb(0,"div",24)}function k(t,e){1&t&&y.Mb(0,"div",25)}function E(t,e){1&t&&y.Mb(0,"div",26)}function R(t,e){1&t&&y.Mb(0,"div",27)}function Q(t,e){1&t&&y.Mb(0,"div",28)}function T(t,e){1&t&&y.Mb(0,"div",29)}function G(t,e){if(1&t){const t=y.Sb();y.Rb(0,"div",2),y.Rb(1,"div",3),y.Dc(2),y.dc(3,"translate"),y.Qb(),y.Rb(4,"div",4),y.Rb(5,"mat-form-field",5),y.Rb(6,"mat-label"),y.Dc(7),y.dc(8,"translate"),y.Qb(),y.Mb(9,"input",6),y.Qb(),y.Rb(10,"mat-form-field",5),y.Rb(11,"mat-label"),y.Dc(12),y.dc(13,"translate"),y.Qb(),y.Mb(14,"input",7),y.Rb(15,"mat-autocomplete",null,8),y.Bc(17,S,2,2,"mat-option",9),y.Qb(),y.Qb(),y.Rb(18,"mat-form-field",5),y.Rb(19,"mat-label"),y.Dc(20),y.dc(21,"translate"),y.Qb(),y.Mb(22,"input",10),y.Rb(23,"mat-autocomplete",null,11),y.Bc(25,C,2,2,"mat-option",9),y.Qb(),y.Qb(),y.Rb(26,"mat-slide-toggle",12),y.Dc(27),y.dc(28,"translate"),y.Qb(),y.Rb(29,"button",13),y.Yb("click",function(){return y.sc(t),y.cc().applyFilters()}),y.Dc(30),y.dc(31,"translate"),y.Qb(),y.Qb(),y.Rb(32,"div",14),y.Bc(33,D,3,3,"button",15),y.Bc(34,j,1,0,"div",16),y.Bc(35,k,1,0,"div",17),y.Bc(36,E,1,0,"div",18),y.Bc(37,R,1,0,"div",19),y.Bc(38,Q,1,0,"div",20),y.Bc(39,T,1,0,"div",21),y.Qb(),y.Qb()}if(2&t){const t=y.pc(16),e=y.pc(24),i=y.cc();y.Ab(2),y.Ec(y.ec(3,19,"top-n.subtitle")),y.Ab(2),y.ic("formGroup",i.formGroup),y.Ab(3),y.Ec(y.ec(8,21,"top-n.header.num-elements")),y.Ab(5),y.Ec(y.ec(13,23,"top-n.header.attribute")),y.Ab(2),y.ic("matAutocomplete",t),y.Ab(3),y.ic("ngForOf",i.attributes),y.Ab(3),y.Ec(y.ec(21,25,"top-n.header.period")),y.Ab(2),y.ic("matAutocomplete",e),y.Ab(3),y.ic("ngForOf",i.periods),y.Ab(2),y.Fc(" ",y.ec(28,27,"top-n.header.toggle")," "),y.Ab(2),y.ic("disabled",i.formGroup.invalid),y.Ab(1),y.Fc(" ",y.ec(31,29,"top-n.header.submit")," "),y.Ab(3),y.ic("ngIf",i.hide.meso||i.hide.micro||i.hide.municipy),y.Ab(1),y.ic("ngIf",!i.hide.meso),y.Ab(1),y.ic("ngIf",!i.hide.meso),y.Ab(1),y.ic("ngIf",!i.hide.meso),y.Ab(1),y.ic("ngIf",!i.hide.micro),y.Ab(1),y.ic("ngIf",!i.hide.micro),y.Ab(1),y.ic("ngIf",!i.hide.municipy)}}let q=(()=>{class t{constructor(t,e,i){this.engineService=t,this.pubsub=e,this.cdr=i,this.attributes=[],this.periods=[],this.formGroup=new c.f({numberOfElements:new c.c(5,[c.q.required]),attribute:new c.c(null,[c.q.required]),period:new c.c(null,[c.q.required]),decrescent:new c.c(!0)}),this.hide={meso:!1,micro:!1,municipy:!1},this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.pubsub.getAsBehaviorSubject(g.a.GLOBAL_STATE_CHANGE).pipe(Object(m.a)(Boolean),Object(h.a)(t=>this.engineService.getEngineEvolution(t))).subscribe(t=>{this.initiated=!0,this.attributes=t.dataFor.map(d.a.build),this.periods=t.periods.map(d.a.build),this.baseFilters={attributes:t.dataFor,periods:t.periods},this.evolutionData={municipalities:Object.values(t.municipalities),microregion:Object.values(t.microregion),mesoregion:Object.values(t.mesoregion)}})),this.subscriptions.push(this.formGroup.controls.attribute.valueChanges.pipe(Object(f.a)(300)).subscribe(t=>{this.attributes=this.baseFilters.attributes.filter(e=>v.a.contains(e,t)).map(d.a.build),this.cdr.detectChanges()}),this.formGroup.controls.period.valueChanges.pipe(Object(f.a)(300)).subscribe(t=>{this.periods=this.baseFilters.periods.filter(e=>v.a.contains(e,t)).map(d.a.build),this.cdr.detectChanges()}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}applyFilters(){const t=this.formGroup.value,e=this.baseFilters.attributes.indexOf(t.attribute),i=this.baseFilters.periods.indexOf(t.period);this.dataset=["mesoregion","microregion","municipalities"].map(r=>{const o=this.evolutionData[r].map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return t.decrescent&&o.reverse(),o}),this.buildCharts(i,e)}buildCharts(t,e){Object.keys(this.hide).forEach(t=>this.hide[t]=!1),document.querySelectorAll(".chart-outlet").forEach(t=>t.innerHTML=""),setTimeout(()=>{const i=this.baseFilters.periods[t],r=this.baseFilters.attributes[e],o=this.formGroup.value.numberOfElements;let[a,n,c]=this.dataset;a=a.slice(0,o),n=n.slice(0,o),c=c.slice(0,o),[a,n,c].forEach((a,n)=>{const c=document.querySelector("#chart-"+(n+1));let s="mesoregion",l="a";1===n?(s="microregion",l="b"):2===n&&(s="municipalities",l="c");const u=[{typeOfSet:s,group:l,period:i,attribute:r,periodIndex:t,attributeIndex:e,x:a.map(({name:t})=>t),y:a.map(({attribute:t})=>t),type:"bar"}],p={title:this.buildChartTitle(o,r,n,1===o,i,this.dataset[n].length)};w.newPlot(c,u,p,{responsive:!0}),c.on("plotly_click",t=>{const[e]=t.points;this.handleMainChartClick({period:i,attribute:r,label:e.label,attributeIndex:e.data.attributeIndex,periodIndex:e.data.periodIndex,typeOfSet:e.data.typeOfSet})})})},100)}buildChartTitle(t,e,i,r,o,a){let n=`Top ${t=t>a?a:t} de ${a} - ${o} - ${e} <br>`;return n+=0===i?r?"Mesorregi\xe3o":"Mesorregi\xf5es":1===i?r?"Microrregi\xe3o":"Microrregi\xf5es":r?"Munic\xedpios":"Munic\xedpio",n}handleMainChartClick(t){const e=this.formGroup.value.numberOfElements,i=this.formGroup.controls.decrescent.value,{periodIndex:r,attributeIndex:o,label:a,period:n,attribute:c}=t;if("mesoregion"===t.typeOfSet){const s=document.querySelector("#chart-1-a-1");this.hide.micro=!0,this.hide.municipy=!0;const l=this.getMicroregionsOfDataMesoregion(t,o,r,i),u=l.slice(0,e);setTimeout(()=>s.scrollIntoView(),300),this.buildSet(u.map(({name:t})=>t),u.map(({attribute:t})=>t),"green",this.buildSubChartTitle(e,l.length,n,c,"Microrregi\xf5es contidas na Mesorregi\xe3o",a),s,t=>{const a=document.querySelector("#chart-1-a-2"),[s]=t.points,l=this.getMunicipalitiesOfDataMicroregion(s,o,r,i),u=l.slice(0,e);setTimeout(()=>a.scrollIntoView(),300),this.buildSet(u.map(({name:t})=>t),u.map(({attribute:t})=>t),"orange",this.buildSubChartTitle(e,l.length,n,c,"Munic\xedpios contidos na Microrregi\xe3o",s.label),a)})}else if("microregion"===t.typeOfSet){this.hide.meso=!0,this.hide.municipy=!0;const a=this.getMunicipalitiesOfDataMicroregion(t,o,r,i),s=a.slice(0,e);this.buildSet(s.map(({name:t})=>t),s.map(({attribute:t})=>t),"orange",this.buildSubChartTitle(e,a.length,n,c,"Munic\xedpios contidos na Microrregi\xe3o",t.label),document.querySelector("#chart-2-a-1"))}}buildSubChartTitle(t,e,i,r,o,a){return`Top ${t>e?e:t} de ${e} - ${i} - ${r} ${o?"<br>"+o+"<br>":""} ${a}`}buildSet(t,e,i,r,o,a=null){o.innerHTML="",w.newPlot(o,[{x:t,y:e,type:"bar",marker:{color:i}}],{title:r},{responsive:!0}),a&&o.on("plotly_click",a)}getMicroregionsOfDataMesoregion(t,e,i,r){const o=Object.values(this.evolutionData.mesoregion).find(({name:e})=>e===t.label),a=Object.values(this.evolutionData.microregion).filter(({mesoregion_id:t})=>t===o.id).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return r&&a.reverse(),a}getMunicipalitiesOfDataMicroregion(t,e,i,r){const o=Object.values(this.evolutionData.microregion).find(({name:e})=>e===t.label),a=Object.values(this.evolutionData.municipalities).filter(({microregion_id:t})=>t===o.id).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return r&&a.reverse(),a}}return t.\u0275fac=function(e){return new(e||t)(y.Lb(M.a),y.Lb(I.a),y.Lb(y.h))},t.\u0275cmp=y.Fb({type:t,selectors:[["app-topn"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","top-n-wrapper",4,"ngIf"],[1,"top-n-wrapper"],[1,"toolbar"],[1,"header",3,"formGroup"],["appearance","outline",1,"filter-element"],["matInput","","formControlName","numberOfElements"],["matInput","","formControlName","attribute",3,"matAutocomplete"],["attrsRef","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","period",3,"matAutocomplete"],["periodRef","matAutocomplete"],["formControlName","decrescent"],["mat-raised-button","","color","accent",3,"disabled","click"],[1,"content"],["mat-raised-button","","color","accent","class","reset-button",3,"click",4,"ngIf"],["id","chart-1","class","chart-outlet",4,"ngIf"],["id","chart-1-a-1","class","chart-outlet",4,"ngIf"],["id","chart-1-a-2","class","chart-outlet",4,"ngIf"],["id","chart-2","class","chart-outlet",4,"ngIf"],["id","chart-2-a-1","class","chart-outlet",4,"ngIf"],["id","chart-3","class","chart-outlet",4,"ngIf"],[3,"value"],["mat-raised-button","","color","accent",1,"reset-button",3,"click"],["id","chart-1",1,"chart-outlet"],["id","chart-1-a-1",1,"chart-outlet"],["id","chart-1-a-2",1,"chart-outlet"],["id","chart-2",1,"chart-outlet"],["id","chart-2-a-1",1,"chart-outlet"],["id","chart-3",1,"chart-outlet"]],template:function(t,e){1&t&&(y.Bc(0,F,1,0,"select-project-warning",0),y.Bc(1,G,40,31,"div",1)),2&t&&(y.ic("ngIf",!e.initiated),y.Ab(1),y.ic("ngIf",e.initiated))},directives:[b.l,O.a,c.m,c.g,l.b,l.f,s.a,c.b,c.l,c.e,u.c,u.a,b.k,A.a,o.b,x.h],pipes:[n.c],styles:["[_ngcontent-%COMP%]:root{--pallete-primary:#000;--pallete-accent:#000;--sidenav-width:200px}  .top-n-wrapper .header{display:flex;align-items:center;justify-content:space-around;padding:16px}  .top-n-wrapper .header .filter-element{width:100%;margin-right:16px}  .top-n-wrapper .header .filter-element .mat-form-field-wrapper{padding-bottom:0;margin:0}  .top-n-wrapper .header .mat-slide-toggle{height:55px;min-width:250px}  .top-n-wrapper .header button{min-width:100px;margin-left:16px}  .top-n-wrapper .filter-element .mat-form-field-outline{background:#fff}  .top-n-wrapper .content{height:calc(var(--innerHeight) - 215px);overflow-y:auto;overflow-x:hidden;background:#fff}  .top-n-wrapper .reset-button{margin-top:16px;margin-left:16px}  .top-n-wrapper .chart-element{width:95%;max-width:95%}  .is-mobile .top-n-wrapper .content{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}  .is-mobile .top-n-wrapper text.gtitle{font-size:14px!important}  .is-mobile .top-n-wrapper .header{flex-wrap:wrap}  .is-mobile .top-n-wrapper .header .filter-element{margin:0 0 16px}  .is-mobile .top-n-wrapper .header .mat-slide-toggle{margin:0 0 16px auto}  .is-mobile .top-n-wrapper .header button{width:100%;margin:0}  .is-phone .top-n-wrapper .header .mat-slide-toggle{margin-right:auto}"]}),t})(),B=(()=>{class t{}return t.\u0275mod=y.Jb({type:t}),t.\u0275inj=y.Ib({factory:function(e){return new(e||t)},imports:[[b.c,p.e.forChild([{path:"",component:q}])],p.e]}),t})(),$=(()=>{class t{}return t.\u0275mod=y.Jb({type:t}),t.\u0275inj=y.Ib({factory:function(e){return new(e||t)},imports:[[b.c,B,u.b,l.d,s.b,n.b,c.h,A.b,c.p,a.b,r.a,o.c]]}),t})()}}]);