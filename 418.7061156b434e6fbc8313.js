(self.webpackChunkvyr=self.webpackChunkvyr||[]).push([[418],{9418:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ComparisonModule:()=>J});var o=i(7070),n=i(3337),s=i(4369),a=i(1041),r=i(9572),l=i(6489),c=i(4446),h=i(649),d=i(1346),g=i(3835),u=i(4689),m=i(3837),p=i(1305),v=i(1744),f=i(5366),y=i(9348),x=i(7723),b=i(1116),Z=i(5420),w=i(7997),A=i(373),E=i(7307);const _=["accordion"];function M(e,t){1&e&&f._UZ(0,"select-project-warning")}function T(e,t){1&e&&(f.TgZ(0,"div",4),f._uU(1),f.ALo(2,"translate"),f.qZA()),2&e&&(f.xp6(1),f.Oqu(f.lcZ(2,1,"comparison.subtitle")))}function C(e,t){1&e&&(f.TgZ(0,"div",12),f.TgZ(1,"div",13),f.TgZ(2,"div",14),f._uU(3),f.ALo(4,"translate"),f.qZA(),f.TgZ(5,"div",15),f._uU(6),f.ALo(7,"translate"),f.qZA(),f.qZA(),f.qZA()),2&e&&(f.xp6(3),f.Oqu(f.lcZ(4,2,"comparison.info.title")),f.xp6(3),f.Oqu(f.lcZ(7,4,"comparison.info.content")))}function $(e,t){if(1&e){const e=f.EpF();f.TgZ(0,"div",20),f.TgZ(1,"div",21),f.TgZ(2,"mat-slide-toggle",22),f.NdJ("change",function(t){f.CHM(e);const i=f.oxw().index,o=f.oxw(2);return o.toggles.hierarchy[i]=t.checked,o.setupCharts(i)}),f._uU(3),f.ALo(4,"translate"),f._UZ(5,"help-icon",23),f.ALo(6,"translate"),f.qZA(),f.TgZ(7,"mat-slide-toggle",22),f.NdJ("change",function(t){f.CHM(e);const i=f.oxw().index,o=f.oxw(2);return o.toggles.averages[i]=t.checked,o.setupCharts(i)}),f._uU(8),f.ALo(9,"translate"),f._UZ(10,"help-icon",23),f.ALo(11,"translate"),f.qZA(),f.qZA(),f.TgZ(12,"button",24),f.TgZ(13,"mat-icon"),f._uU(14,"more_vert"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(15,"mat-menu",25,26),f.TgZ(17,"button",27),f.NdJ("click",function(){f.CHM(e);const t=f.oxw(3);return t.viewDetails(t.selectedRegionA)}),f._uU(18),f.ALo(19,"translate"),f.ALo(20,"translate"),f.qZA(),f.TgZ(21,"button",27),f.NdJ("click",function(){f.CHM(e);const t=f.oxw(3);return t.viewDetails(t.selectedRegionB)}),f._uU(22),f.ALo(23,"translate"),f.ALo(24,"translate"),f.qZA(),f.qZA(),f._UZ(25,"div",28),f._UZ(26,"div",28),f._UZ(27,"div",28)}if(2&e){const e=f.MAs(16),t=f.oxw().index,i=f.oxw(2);f.xp6(2),f.Q6J("checked",!1),f.xp6(1),f.hij(" ",f.lcZ(4,17,"comparison.show-hierarchy")," "),f.xp6(2),f.Q6J("text",f.lcZ(6,19,"comparison.show-hierarchy-help")),f.xp6(2),f.Q6J("checked",!1),f.xp6(1),f.hij(" ",f.lcZ(9,21,"comparison.show-averages")," "),f.xp6(2),f.Q6J("text",f.lcZ(11,23,"comparison.show-averages-help")),f.xp6(2),f.Q6J("matMenuTriggerFor",e),f.xp6(3),f.Q6J("backdropClass","comparison-option-modal"),f.xp6(3),f.lnq(" ",f.lcZ(19,25,"comparison.view-details")," - ",f.lcZ(20,27,i.selectedRegionA.descriptor)," ",i.selectedRegionA.name," "),f.xp6(4),f.lnq(" ",f.lcZ(23,29,"comparison.view-details")," - ",f.lcZ(24,31,i.selectedRegionB.descriptor)," ",i.selectedRegionB.name," "),f.xp6(3),f.MGl("id","element-chart-1-",t,""),f.xp6(1),f.MGl("id","element-chart-2-",t,""),f.xp6(1),f.MGl("id","element-chart-3-",t,"")}}function q(e,t){if(1&e){const e=f.EpF();f.TgZ(0,"mat-expansion-panel",16),f.NdJ("closed",function(){return f.CHM(e),f.oxw(2).featuredLabel=""})("opened",function(){const t=f.CHM(e).index,i=f.oxw(2);return i.initToggles(t),i.setupCharts(t)}),f.TgZ(1,"mat-expansion-panel-header",17,18),f._uU(3),f.qZA(),f.YNc(4,$,28,33,"ng-template",19),f.qZA()}if(2&e){const e=t.$implicit;f.Gre("numeric-value-descriptor descriptor-",t.index,""),f.xp6(3),f.hij(" ",e," ")}}const L=function(e){return{"display-none":e}};function P(e,t){if(1&e){const e=f.EpF();f.TgZ(0,"div",5),f.TgZ(1,"div",6),f.TgZ(2,"region-selector",7),f.NdJ("onSelect",function(t){f.CHM(e);const i=f.oxw();return i.selectedRegionA=t,i.handleRegionChanges()}),f.qZA(),f.TgZ(3,"region-selector",7),f.NdJ("onSelect",function(t){f.CHM(e);const i=f.oxw();return i.selectedRegionB=t,i.handleRegionChanges()}),f.qZA(),f.qZA(),f.YNc(4,C,8,6,"div",8),f.TgZ(5,"mat-accordion",9,10),f.YNc(7,q,5,4,"mat-expansion-panel",11),f.qZA(),f.qZA()}if(2&e){const e=f.oxw();f.xp6(4),f.Q6J("ngIf",!e.filteredEvolutionData),f.xp6(1),f.Q6J("ngClass",f.VKq(4,L,!e.filteredEvolutionData))("multi",!0),f.xp6(2),f.Q6J("ngForOf",null==e.evolutionPayload?null:e.evolutionPayload.dataFor)}}let S=(()=>{class e{constructor(e,t,i,o){this.pubsub=e,this.engineService=t,this.translateService=i,this.router=o,this.toggles={hierarchy:{},averages:{}},this.subscriptions=[],this.colors={selectedA:"#1E1EA9",selectedB:"#028a12",hierarchyMicro:"#665191",hierarchyMeso:"#a05195",hierarchyState:"#d45087",averageMicro:"#f95d6a",averageMeso:"#ff7c43",averageState:"#ffa600"},this.regionLabels={uf:"",mesoregion:"",microregion:"",municipalities:""}}ngOnInit(){this.subscriptions.push(this.pubsub.getAsBehaviorSubject(m.Y.GLOBAL_STATE_CHANGE).pipe((0,g.h)(e=>!!e),(0,u.w)(e=>this.engineService.getEngineEvolution(e))).subscribe(e=>{this.initiated=!0,this.evolutionPayload=e})),this.subscriptions.push((0,p.aj)([this.translateService.get("model-constants.state"),this.translateService.get("model-constants.mesoregion"),this.translateService.get("model-constants.microregion"),this.translateService.get("model-constants.municipy")]).subscribe(e=>{this.regionLabels.uf=e[0],this.regionLabels.mesoregion=e[1],this.regionLabels.microregion=e[2],this.regionLabels.municipalities=e[3]}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}viewDetails(e){localStorage.setItem("details-dataset",JSON.stringify(e)),this.router.navigate(["region-details"])}handleRegionChanges(){this.selectedRegionA&&this.selectedRegionB&&(this.filteredEvolutionData={a:Object.assign(Object.assign({},this.evolutionPayload[this.selectedRegionA.slug][this.selectedRegionA.id]),{descriptor:this.selectedRegionA.descriptor,slug:this.selectedRegionA.slug}),b:Object.assign(Object.assign({},this.evolutionPayload[this.selectedRegionB.slug][this.selectedRegionB.id]),{descriptor:this.selectedRegionB.descriptor,slug:this.selectedRegionB.slug})},this.buildOtherLevels(),this.accordion.closeAll())}initToggles(e){void 0===this.toggles.hierarchy[e]&&(this.toggles.hierarchy[e]=!1),void 0===this.toggles.averages[e]&&(this.toggles.averages[e]=!1)}setupCharts(e){setTimeout(()=>{const t={a:`${this.regionLabels[this.filteredEvolutionData.a.slug]} ${this.filteredEvolutionData.a.name}`,b:`${this.regionLabels[this.filteredEvolutionData.b.slug]} ${this.filteredEvolutionData.b.name}`},i={a:this.filteredEvolutionData.a.numericEvolution[e].value,b:this.filteredEvolutionData.b.numericEvolution[e].value},o=document.querySelector(`#element-chart-1-${e}`),n=document.querySelector(`#element-chart-2-${e}`);o&&(o.innerHTML="",v.newPlot(o,[{x:this.evolutionPayload.periods,y:i.a,name:t.a,type:"lines+markers",marker:{color:this.colors.selectedA,width:1}},...this.toggles.hierarchy[e]?this.getExtraCharts("a",e):[],{x:this.evolutionPayload.periods,y:i.b,name:t.b,type:"lines+markers",marker:{color:this.colors.selectedB,width:1}},...this.toggles.hierarchy[e]?this.getExtraCharts("b",e):[],...this.toggles.averages[e]?this.getExtraCharts("a",e,!1):[],...this.toggles.averages[e]?this.getExtraCharts("b",e,!1):[]],{title:"Incid\xeancia",xaxis:{type:"category",title:"Per\xedodo"},yaxis:{title:"Valor"},legend:{orientation:"h",y:-.25}},{responsive:!0})),n&&(n.innerHTML="",v.newPlot(n,[{y:i.a,name:t.a,type:"box",marker:{color:this.colors.selectedA}},{y:i.b,name:t.b,type:"box",marker:{color:this.colors.selectedB}}],{title:"Performance",legend:{orientation:"h",y:-.1}},{responsive:!0}))},0)}getExtraCharts(e,t,i=!0){return this[i?"hierarchy":"averages"].filter(({set:t})=>t===e).map(e=>({x:this.evolutionPayload.periods,y:e.numericEvolution[t].value,name:e.title,type:"lines+markers",marker:{color:e.color,width:1}}))}buildOtherLevels(){this.hierarchy=[],this.averages=[];const e=Object.values(this.evolutionPayload.municipalities),t=Object.values(this.evolutionPayload.microregion),i=Object.values(this.evolutionPayload.mesoregion);[this.selectedRegionA,this.selectedRegionB].forEach((o,n)=>{const s=0===n?"a":"b";if("municipalities"===o.slug){const i=this.evolutionPayload.microregion[this.evolutionPayload.municipalities[o.id].microregion_id];i.set=s,i.title=`${this.regionLabels.microregion} ${i.name}`,i.color=this.colors.hierarchyMicro;const n=e.filter(({microregion_id:e})=>e===i.id).length,a={set:s,id:`avg-${i.id}`,title:`M\xe9dia da Microrregi\xe3o ${i.name}`,color:this.colors.averageMicro,numericEvolution:i.numericEvolution.map(e=>({meta_id:e.meta_id,value:e.value.map(e=>e/n)}))},r=this.evolutionPayload.mesoregion[i.mesoregion_id];r.set=s,r.title=`${this.regionLabels.mesoregion} ${r.name}`,r.color=this.colors.hierarchyMeso;const l=t.filter(({mesoregion_id:e})=>e===r.id).map(({id:e})=>e).reduce((t,i)=>t+e.filter(({microregion_id:e})=>e===i).length,0),c={set:s,id:`avg-${r.id}`,title:`M\xe9dia da Mesorregi\xe3o ${r.name}`,color:this.colors.averageMeso,numericEvolution:r.numericEvolution.map(e=>({meta_id:e.meta_id,value:e.value.map(e=>e/l)}))},h=this.evolutionPayload.uf[r.uf_id];h.set=s,h.title=`${this.regionLabels.uf} ${h.name}`,h.color=this.colors.hierarchyState;const d={set:s,id:`avg-${h.id}`,title:`M\xe9dia do Estado ${h.name}`,color:this.colors.averageState,numericEvolution:h.numericEvolution.map(t=>({meta_id:t.meta_id,value:t.value.map(t=>t/e.length)}))};[i,r,h].forEach(e=>{this.hierarchy.every(({id:t})=>e.id!==t)&&this.hierarchy.push(e)}),[a,c,d].forEach(e=>{this.averages.every(({id:t})=>e.id!==t)&&this.averages.push(e)})}else if("microregion"===o.slug){const e=this.evolutionPayload.mesoregion[this.evolutionPayload.microregion[o.id].mesoregion_id];e.title=`${this.regionLabels.mesoregion} ${e.name}`,e.color=this.colors.hierarchyMeso,e.set=s;const i=t.filter(({mesoregion_id:t})=>t===e.id).length,n={set:s,id:`avg-${e.id}`,title:`M\xe9dia da Mesorregi\xe3o ${e.name}`,color:this.colors.averageMeso,numericEvolution:e.numericEvolution.map(e=>({meta_id:e.meta_id,value:e.value.map(e=>e/i)}))},a=this.evolutionPayload.uf[e.uf_id];a.set=s,a.title=`${this.regionLabels.uf} ${a.name}`,a.color=this.colors[`${s}Sta`];const r={set:s,id:`avg-${a.id}`,title:`M\xe9dia do Estado ${a.name}`,color:this.colors.averageState,numericEvolution:a.numericEvolution.map(e=>({meta_id:e.meta_id,value:e.value.map(e=>e/t.length)}))};[e,a].forEach(e=>{this.hierarchy.every(({id:t})=>e.id!==t)&&this.hierarchy.push(e)}),[n,r].forEach(e=>{this.hierarchy.every(({id:t})=>e.id!==t)&&this.hierarchy.push(e)})}else if("mesoregion"===o.slug){const e=this.evolutionPayload.uf[this.evolutionPayload.mesoregion[o.id].uf_id];e.set=s,e.title=`${this.regionLabels.uf} ${e.name}`,e.color=this.colors.hierarchyState;const t=i.filter(({uf_id:t})=>t===e.id).length,n={set:s,id:`avg-${e.id}`,title:`M\xe9dia do Estado ${e.name}`,color:this.colors.averageState,numericEvolution:e.numericEvolution.map(e=>({meta_id:e.meta_id,value:e.value.map(e=>e/t)}))};this.hierarchy.every(({id:t})=>e.id!==t)&&this.hierarchy.push(e),this.averages.every(({id:e})=>n.id!==e)&&this.averages.push(n)}})}}return e.\u0275fac=function(t){return new(t||e)(f.Y36(y.A),f.Y36(x.S),f.Y36(h.sK),f.Y36(n.F0))},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-comparison"]],viewQuery:function(e,t){if(1&e&&f.Gf(_,5),2&e){let e;f.iGM(e=f.CRH())&&(t.accordion=e.first)}},decls:4,vars:3,consts:[[1,"view-comparison"],[4,"ngIf"],["class","toolbar",4,"ngIf"],["class","content",4,"ngIf"],[1,"toolbar"],[1,"content"],[1,"content-header"],[3,"onSelect"],["class","parametric-search-content","style","margin-top: 16px;",4,"ngIf"],[1,"accordion",3,"ngClass","multi"],["accordion","matAccordion"],[3,"class","closed","opened",4,"ngFor","ngForOf"],[1,"parametric-search-content",2,"margin-top","16px"],[1,"box","box-info"],[1,"box-title"],[1,"box-content"],[3,"closed","opened"],["collapsedHeight","48px","expandedHeight","48px"],["itemLabel",""],["matExpansionPanelContent",""],[1,"options"],[1,"left"],[1,"toggle-help",3,"checked","change"],[3,"text"],["mat-icon-button","",3,"matMenuTriggerFor"],[3,"backdropClass"],["menu","matMenu"],["mat-menu-item","",3,"click"],[3,"id"]],template:function(e,t){1&e&&(f.TgZ(0,"div",0),f.YNc(1,M,1,0,"select-project-warning",1),f.YNc(2,T,3,3,"div",2),f.YNc(3,P,8,6,"div",3),f.qZA()),2&e&&(f.xp6(1),f.Q6J("ngIf",!t.initiated),f.xp6(1),f.Q6J("ngIf",t.initiated),f.xp6(1),f.Q6J("ngIf",t.initiated))},directives:[b.O5,Z.D,w.T,l.pp,b.mk,b.sg,l.ib,l.yz,l.HS,r.Rr,A.w,s.lW,o.p6,E.Hw,o.VK,o.OP],pipes:[h.X$],styles:["[_ngcontent-%COMP%]:root{--pallete-primary:#000;--pallete-accent:#000;--sidenav-width:200px}  .view-comparison .content-header,   .view-comparison .content .options,   .view-comparison .content .options .left{display:flex}  .view-comparison .content .options .left{align-items:center;justify-content:flex-start}  .view-comparison .content-header,   .view-comparison .content .options{align-items:center;justify-content:space-between}  .view-comparison .content{padding:16px;max-height:calc(var(--innerHeight) - 128px);overflow-y:auto}  .view-comparison .content .options .left mat-slide-toggle{margin-right:16px}  .view-comparison .content-header{padding-bottom:16px}  .view-comparison .content-header region-selector{width:100%}  .view-comparison .content-header region-selector:first-child{margin-right:16px}  .is-mobile .view-comparison .content-header{flex-direction:column}  .is-mobile .view-comparison .content-header region-selector:first-child{margin-right:0;margin-bottom:24px}  .comparison-option-modal+div .mat-menu-panel{max-width:100%}"]}),e})(),R=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[b.ez,n.Bz.forChild([{path:"",component:S}])],n.Bz]}),e})();var k=i(408);let J=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[b.ez,R,d.C,h.aw,l.To,c.q,r.rP,a.u5,E.Ps,k.q,s.ot,n.Bz,o.Tx]]}),e})()}}]);