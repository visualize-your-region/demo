(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"M8+y":function(t,e,i){"use strict";i.r(e),i.d(e,"TopnModule",function(){return L});var r=i("mVQt"),n=i("bTqV"),a=i("NFeN"),o=i("sYmb"),s=i("3Pt+"),c=i("qFsG"),l=i("kmnG"),p=i("/1cH"),u=i("tyNb"),m=i("ofXK"),b=i("YX9y"),d=i("pLZG"),h=i("5+tZ"),g=i("Kj3r"),f=i("f48q"),v=i("itXk"),w=i("Iw1v"),y=i("95T3"),x=i("fXoL"),I=i("49/o"),O=i("sVDV"),A=i("FkH8"),S=i("1jcm"),M=i("FKr1");function F(t,e){1&t&&x.Mb(0,"select-project-warning")}function C(t,e){if(1&t&&(x.Rb(0,"mat-option",23),x.Dc(1),x.Qb()),2&t){const t=e.$implicit;x.ic("value",t.label),x.Ab(1),x.Fc(" ",t.label," ")}}function D(t,e){if(1&t&&(x.Rb(0,"mat-option",23),x.Dc(1),x.Qb()),2&t){const t=e.$implicit;x.ic("value",t.label),x.Ab(1),x.Fc(" ",t.label," ")}}function k(t,e){if(1&t){const t=x.Sb();x.Rb(0,"button",24),x.Yb("click",function(){return x.sc(t),x.cc(2).applyFilters()}),x.Dc(1),x.dc(2,"translate"),x.Qb()}2&t&&(x.Ab(1),x.Fc(" ",x.ec(2,1,"common.back")," "))}function j(t,e){1&t&&x.Mb(0,"div",25)}function E(t,e){1&t&&x.Mb(0,"div",26)}function R(t,e){1&t&&x.Mb(0,"div",27)}function Q(t,e){1&t&&x.Mb(0,"div",28)}function T(t,e){1&t&&x.Mb(0,"div",29)}function G(t,e){1&t&&x.Mb(0,"div",30)}function q(t,e){if(1&t){const t=x.Sb();x.Rb(0,"div",2),x.Rb(1,"div",3),x.Dc(2),x.dc(3,"translate"),x.Qb(),x.Rb(4,"div",4),x.Rb(5,"mat-form-field",5),x.Rb(6,"mat-label"),x.Dc(7),x.dc(8,"translate"),x.Qb(),x.Mb(9,"input",6),x.Qb(),x.Rb(10,"mat-form-field",5),x.Rb(11,"mat-label"),x.Dc(12),x.dc(13,"translate"),x.Qb(),x.Mb(14,"input",7),x.Rb(15,"mat-autocomplete",null,8),x.Bc(17,C,2,2,"mat-option",9),x.Qb(),x.Qb(),x.Rb(18,"mat-form-field",5),x.Rb(19,"mat-label"),x.Dc(20),x.dc(21,"translate"),x.Qb(),x.Mb(22,"input",10),x.Rb(23,"mat-autocomplete",null,11),x.Bc(25,D,2,2,"mat-option",9),x.Qb(),x.Qb(),x.Rb(26,"mat-slide-toggle",12),x.Dc(27),x.dc(28,"translate"),x.Qb(),x.Rb(29,"mat-slide-toggle",13),x.Dc(30),x.dc(31,"translate"),x.Qb(),x.Rb(32,"button",14),x.Yb("click",function(){return x.sc(t),x.cc().applyFilters()}),x.Dc(33),x.dc(34,"translate"),x.Qb(),x.Qb(),x.Rb(35,"div",15),x.Bc(36,k,3,3,"button",16),x.Bc(37,j,1,0,"div",17),x.Bc(38,E,1,0,"div",18),x.Bc(39,R,1,0,"div",19),x.Bc(40,Q,1,0,"div",20),x.Bc(41,T,1,0,"div",21),x.Bc(42,G,1,0,"div",22),x.Qb(),x.Qb()}if(2&t){const t=x.pc(16),e=x.pc(24),i=x.cc();x.Ab(2),x.Ec(x.ec(3,20,"top-n.subtitle")),x.Ab(2),x.ic("formGroup",i.formGroup),x.Ab(3),x.Ec(x.ec(8,22,"top-n.header.num-elements")),x.Ab(5),x.Ec(x.ec(13,24,"top-n.header.attribute")),x.Ab(2),x.ic("matAutocomplete",t),x.Ab(3),x.ic("ngForOf",i.attributes),x.Ab(3),x.Ec(x.ec(21,26,"top-n.header.period")),x.Ab(2),x.ic("matAutocomplete",e),x.Ab(3),x.ic("ngForOf",i.periods),x.Ab(2),x.Fc(" ",x.ec(28,28,"top-n.header.toggle")," "),x.Ab(3),x.Fc(" ",x.ec(31,30,"top-n.header.toggle-zero")," "),x.Ab(2),x.ic("disabled",i.formGroup.invalid),x.Ab(1),x.Fc(" ",x.ec(34,32,"top-n.header.submit")," "),x.Ab(3),x.ic("ngIf",i.hide.meso||i.hide.micro||i.hide.municipy),x.Ab(1),x.ic("ngIf",!i.hide.meso),x.Ab(1),x.ic("ngIf",!i.hide.meso),x.Ab(1),x.ic("ngIf",!i.hide.meso),x.Ab(1),x.ic("ngIf",!i.hide.micro),x.Ab(1),x.ic("ngIf",!i.hide.micro),x.Ab(1),x.ic("ngIf",!i.hide.municipy)}}let B=(()=>{class t{constructor(t,e,i,r){this.engineService=t,this.pubsub=e,this.cdr=i,this.translateService=r,this.attributes=[],this.periods=[],this.formGroup=new s.f({numberOfElements:new s.c(5,[s.q.required]),attribute:new s.c(null,[s.q.required]),period:new s.c(null,[s.q.required]),decrescent:new s.c(!0),ignoreZero:new s.c(!1)}),this.hide={meso:!1,micro:!1,municipy:!1},this.subscriptions=[],this.translations={}}ngOnInit(){this.subscriptions.push(Object(v.b)([this.translateService.get("top-n.microregions-in-mesoregion"),this.translateService.get("top-n.municipalities-in-microregion"),this.translateService.get("model-constants.municipy"),this.translateService.get("model-constants.municipalities"),this.translateService.get("model-constants.microregion"),this.translateService.get("model-constants.microregions"),this.translateService.get("model-constants.mesoregion"),this.translateService.get("model-constants.mesoregions")]).subscribe(t=>{this.translations.microInMeso=t[0],this.translations.munInMicro=t[1],this.translations.municipy=t[2],this.translations.municipalities=t[3],this.translations.microregion=t[4],this.translations.microregions=t[5],this.translations.mesoregion=t[6],this.translations.mesoregions=t[7]})),this.subscriptions.push(this.pubsub.getAsBehaviorSubject(f.a.GLOBAL_STATE_CHANGE).pipe(Object(d.a)(Boolean),Object(h.a)(t=>this.engineService.getEngineEvolution(t))).subscribe(t=>{this.initiated=!0,this.attributes=t.dataFor.map(b.a.build),this.periods=t.periods.map(b.a.build),this.baseFilters={attributes:t.dataFor,periods:t.periods},this.evolutionData={municipalities:Object.values(t.municipalities),microregion:Object.values(t.microregion),mesoregion:Object.values(t.mesoregion)}})),this.subscriptions.push(this.formGroup.controls.attribute.valueChanges.pipe(Object(g.a)(300)).subscribe(t=>{this.attributes=this.baseFilters.attributes.filter(e=>w.a.contains(e,t)).map(b.a.build),this.cdr.detectChanges()}),this.formGroup.controls.period.valueChanges.pipe(Object(g.a)(300)).subscribe(t=>{this.periods=this.baseFilters.periods.filter(e=>w.a.contains(e,t)).map(b.a.build),this.cdr.detectChanges()}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}applyFilters(){const t=this.formGroup.value,e=this.baseFilters.attributes.indexOf(t.attribute),i=this.baseFilters.periods.indexOf(t.period);this.dataset=["mesoregion","microregion","municipalities"].map(r=>{const n=this.evolutionData[r].filter(r=>!t.ignoreZero||r.numericEvolution[e].value[i]>0).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return t.decrescent&&n.reverse(),n}),this.buildCharts(i,e)}buildCharts(t,e){Object.keys(this.hide).forEach(t=>this.hide[t]=!1),document.querySelectorAll(".chart-outlet").forEach(t=>t.innerHTML=""),setTimeout(()=>{const i=this.baseFilters.periods[t],r=this.baseFilters.attributes[e],n=this.formGroup.value.numberOfElements;let[a,o,s]=this.dataset;a=a.slice(0,n),o=o.slice(0,n),s=s.slice(0,n),[a,o,s].forEach((a,o)=>{const s=document.querySelector("#chart-"+(o+1));let c="mesoregion",l="a";1===o?(c="microregion",l="b"):2===o&&(c="municipalities",l="c");const p=[{typeOfSet:c,group:l,period:i,attribute:r,periodIndex:t,attributeIndex:e,x:a.map(({name:t})=>t),y:a.map(({attribute:t})=>t),type:"bar"}],u={title:this.buildChartTitle(n,r,o,1===n,i,this.dataset[o].length)};y.newPlot(s,p,u,{responsive:!0}),s.on("plotly_click",t=>{const[e]=t.points;this.handleMainChartClick({period:i,attribute:r,label:e.label,attributeIndex:e.data.attributeIndex,periodIndex:e.data.periodIndex,typeOfSet:e.data.typeOfSet})})})},100)}buildChartTitle(t,e,i,r,n,a){let o=`Top ${t=t>a?a:t} de ${a} - ${n} - ${e} <br>`;return o+=0===i?r?this.translations.mesoregions:this.translations.mesoregion:1===i?r?this.translations.microregions:this.translations.mesoregion:r?this.translations.municipalities:this.translations.municipy,o}handleMainChartClick(t){const e=this.formGroup.value.numberOfElements,i=this.formGroup.controls.decrescent.value,{periodIndex:r,attributeIndex:n,label:a,period:o,attribute:s}=t;if("mesoregion"===t.typeOfSet){const c=document.querySelector("#chart-1-a-1");this.hide.micro=!0,this.hide.municipy=!0;const l=this.getMicroregionsOfDataMesoregion(t,n,r,i),p=l.slice(0,e);setTimeout(()=>c.scrollIntoView(),300),this.buildSet(p.map(({name:t})=>t),p.map(({attribute:t})=>t),"green",this.buildSubChartTitle(e,l.length,o,s,this.translations.microInMeso,a),c,t=>{const a=document.querySelector("#chart-1-a-2"),[c]=t.points,l=this.getMunicipalitiesOfDataMicroregion(c,n,r,i),p=l.slice(0,e);setTimeout(()=>a.scrollIntoView(),300),this.buildSet(p.map(({name:t})=>t),p.map(({attribute:t})=>t),"orange",this.buildSubChartTitle(e,l.length,o,s,this.translations.munInMicro,c.label),a)})}else if("microregion"===t.typeOfSet){this.hide.meso=!0,this.hide.municipy=!0;const a=this.getMunicipalitiesOfDataMicroregion(t,n,r,i),c=a.slice(0,e);this.buildSet(c.map(({name:t})=>t),c.map(({attribute:t})=>t),"orange",this.buildSubChartTitle(e,a.length,o,s,this.translations.munInMicro,t.label),document.querySelector("#chart-2-a-1"))}}buildSubChartTitle(t,e,i,r,n,a){return`Top ${t>e?e:t} de ${e} - ${i} - ${r} ${n?"<br>"+n+"<br>":""} ${a}`}buildSet(t,e,i,r,n,a=null){n.innerHTML="",y.newPlot(n,[{x:t,y:e,type:"bar",marker:{color:i}}],{title:r},{responsive:!0}),a&&n.on("plotly_click",a)}getMicroregionsOfDataMesoregion(t,e,i,r){const n=Object.values(this.evolutionData.mesoregion).find(({name:e})=>e===t.label),a=Object.values(this.evolutionData.microregion).filter(({mesoregion_id:t})=>t===n.id).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return r&&a.reverse(),a}getMunicipalitiesOfDataMicroregion(t,e,i,r){const n=Object.values(this.evolutionData.microregion).find(({name:e})=>e===t.label),a=Object.values(this.evolutionData.municipalities).filter(({microregion_id:t})=>t===n.id).map(t=>({id:t.id,name:t.name,attribute:t.numericEvolution[e].value[i]})).sort((t,e)=>t.attribute-e.attribute);return r&&a.reverse(),a}}return t.\u0275fac=function(e){return new(e||t)(x.Lb(I.a),x.Lb(O.a),x.Lb(x.h),x.Lb(o.d))},t.\u0275cmp=x.Fb({type:t,selectors:[["app-topn"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","top-n-wrapper",4,"ngIf"],[1,"top-n-wrapper"],[1,"toolbar"],[1,"header",3,"formGroup"],["appearance","outline",1,"filter-element"],["matInput","","formControlName","numberOfElements"],["matInput","","formControlName","attribute",3,"matAutocomplete"],["attrsRef","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","period",3,"matAutocomplete"],["periodRef","matAutocomplete"],["formControlName","decrescent"],["formControlName","ignoreZero",2,"min-width","120px","margin-left","8px"],["mat-raised-button","","color","accent",3,"disabled","click"],[1,"content"],["mat-raised-button","","color","accent","class","reset-button",3,"click",4,"ngIf"],["id","chart-1","class","chart-outlet",4,"ngIf"],["id","chart-1-a-1","class","chart-outlet",4,"ngIf"],["id","chart-1-a-2","class","chart-outlet",4,"ngIf"],["id","chart-2","class","chart-outlet",4,"ngIf"],["id","chart-2-a-1","class","chart-outlet",4,"ngIf"],["id","chart-3","class","chart-outlet",4,"ngIf"],[3,"value"],["mat-raised-button","","color","accent",1,"reset-button",3,"click"],["id","chart-1",1,"chart-outlet"],["id","chart-1-a-1",1,"chart-outlet"],["id","chart-1-a-2",1,"chart-outlet"],["id","chart-2",1,"chart-outlet"],["id","chart-2-a-1",1,"chart-outlet"],["id","chart-3",1,"chart-outlet"]],template:function(t,e){1&t&&(x.Bc(0,F,1,0,"select-project-warning",0),x.Bc(1,q,43,34,"div",1)),2&t&&(x.ic("ngIf",!e.initiated),x.Ab(1),x.ic("ngIf",e.initiated))},directives:[m.l,A.a,s.m,s.g,l.b,l.f,c.a,s.b,s.l,s.e,p.c,p.a,m.k,S.a,n.b,M.h],pipes:[o.c],styles:["[_ngcontent-%COMP%]:root{--pallete-primary:#000;--pallete-accent:#000;--sidenav-width:200px}  .top-n-wrapper .header{display:flex;align-items:center;justify-content:space-around;padding:16px}  .top-n-wrapper .header .filter-element{width:100%;margin-right:16px}  .top-n-wrapper .header .filter-element .mat-form-field-wrapper{padding-bottom:0;margin:0}  .top-n-wrapper .header .mat-slide-toggle{height:55px;min-width:250px}  .top-n-wrapper .header button{min-width:100px;margin-left:16px}  .top-n-wrapper .filter-element .mat-form-field-outline{background:#fff}  .top-n-wrapper .content{height:calc(var(--innerHeight) - 215px);overflow-y:auto;overflow-x:hidden;background:#fff}  .top-n-wrapper .reset-button{margin-top:16px;margin-left:16px}  .top-n-wrapper .chart-element{width:95%;max-width:95%}@media screen and (min-width:1200px) and (max-width:1300px){  .top-n-wrapper .mat-form-field{width:calc(33.3% - 11px)!important}  .top-n-wrapper .content{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}  .top-n-wrapper text.gtitle{font-size:14px!important}  .top-n-wrapper .header{flex-wrap:wrap;align-items:baseline}  .top-n-wrapper .header .filter-element{margin:0 0 16px}  .top-n-wrapper .header .mat-slide-toggle{margin:0 0 16px auto}}  .is-mobile .top-n-wrapper .content{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}  .is-mobile .top-n-wrapper text.gtitle{font-size:14px!important}  .is-mobile .top-n-wrapper .header{flex-wrap:wrap}  .is-mobile .top-n-wrapper .header .filter-element{margin:0 0 16px}  .is-mobile .top-n-wrapper .header .mat-slide-toggle{margin:0 0 16px auto}  .is-mobile .top-n-wrapper .header button{width:100%;margin:0}  .is-phone .top-n-wrapper .header .mat-slide-toggle{margin-right:auto}"]}),t})(),$=(()=>{class t{}return t.\u0275mod=x.Jb({type:t}),t.\u0275inj=x.Ib({factory:function(e){return new(e||t)},imports:[[m.c,u.e.forChild([{path:"",component:B}])],u.e]}),t})(),L=(()=>{class t{}return t.\u0275mod=x.Jb({type:t}),t.\u0275inj=x.Ib({factory:function(e){return new(e||t)},imports:[[m.c,$,p.b,l.d,c.b,o.b,s.h,S.b,s.p,a.b,r.a,n.c]]}),t})()}}]);